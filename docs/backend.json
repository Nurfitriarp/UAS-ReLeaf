{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the ReLeaf application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "fullName": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "profilePicture": {
          "type": "string",
          "description": "URL to the user's profile picture.",
          "format": "uri"
        },
        "isPsychiatrist": {
          "type": "boolean",
          "description": "Indicates whether the user is a psychiatrist."
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        },
        "communityIds": {
          "type": "array",
          "description": "References to communities. (Relationship: UserProfile N:N Community)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "fullName",
        "email",
        "isPsychiatrist"
      ]
    },
    "PsychiatristProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "PsychiatristProfile",
      "type": "object",
      "description": "Represents the profile of a psychiatrist, extending UserProfile.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the psychiatrist profile."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:1 PsychiatristProfile)"
        },
        "specialization": {
          "type": "string",
          "description": "The psychiatrist's area of specialization."
        },
        "licenseNumber": {
          "type": "string",
          "description": "The psychiatrist's license number."
        },
        "availability": {
          "type": "string",
          "description": "Details of the psychiatrist's availability for appointments."
        }
      },
      "required": [
        "id",
        "userProfileId",
        "specialization",
        "licenseNumber",
        "availability"
      ]
    },
    "Appointment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Appointment",
      "type": "object",
      "description": "Represents a consultation appointment between a patient and a psychiatrist.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the appointment."
        },
        "patientId": {
          "type": "string",
          "description": "Reference to UserProfile (patient). (Relationship: UserProfile 1:N Appointment)"
        },
        "psychiatristId": {
          "type": "string",
          "description": "Reference to PsychiatristProfile. (Relationship: PsychiatristProfile 1:N Appointment)"
        },
        "dateTime": {
          "type": "string",
          "description": "The date and time of the appointment.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "The status of the appointment (e.g., 'scheduled', 'completed', 'cancelled')."
        },
        "notes": {
          "type": "string",
          "description": "Any notes or comments related to the appointment."
        }
      },
      "required": [
        "id",
        "patientId",
        "psychiatristId",
        "dateTime",
        "status"
      ]
    },
    "Article": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Article",
      "type": "object",
      "description": "Represents a mental health article.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the article."
        },
        "title": {
          "type": "string",
          "description": "The title of the article."
        },
        "content": {
          "type": "string",
          "description": "The content of the article (e.g., HTML or Markdown)."
        },
        "author": {
          "type": "string",
          "description": "The author of the article."
        },
        "publicationDate": {
          "type": "string",
          "description": "The date the article was published.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "author",
        "publicationDate"
      ]
    },
    "Community": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Community",
      "type": "object",
      "description": "Represents a community forum for users with shared interests.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the community."
        },
        "name": {
          "type": "string",
          "description": "The name of the community."
        },
        "description": {
          "type": "string",
          "description": "A description of the community's purpose and focus."
        },
        "moderatorId": {
          "type": "string",
          "description": "Reference to UserProfile (moderator). (Relationship: UserProfile 1:N Community)"
        },
        "memberIds": {
          "type": "array",
          "description": "References to UserProfiles (members). (Relationship: Community 1:N UserProfile)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "moderatorId"
      ]
    },
    "GoogleOAuth": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "GoogleOAuth",
      "type": "object",
      "description": "Stores relevant data retrieved from Google OAuth for user authentication. This is for the token and user data obtained upon successful login.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to the UserProfile. (Relationship: GoogleOAuth 1:1 UserProfile)"
        },
        "googleId": {
          "type": "string",
          "description": "Unique user identifier provided by Google."
        },
        "accessToken": {
          "type": "string",
          "description": "Access token received from Google OAuth."
        },
        "refreshToken": {
          "type": "string",
          "description": "Refresh token received from Google OAuth (if applicable)."
        },
        "expirationTime": {
          "type": "string",
          "description": "Expiration time of the access token (ISO 8601 format).",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "googleId",
        "accessToken",
        "expirationTime"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Uses path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/psychiatristProfile/{profileId}",
        "definition": {
          "entityName": "PsychiatristProfile",
          "schema": {
            "$ref": "#/backend/entities/PsychiatristProfile"
          },
          "description": "Stores psychiatrist-specific profile information.  Located as a subcollection to UserProfile, indicating a 1:1 relationship.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "profileId",
              "description": "The unique identifier for the psychiatrist profile."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/appointments/{appointmentId}",
        "definition": {
          "entityName": "Appointment",
          "schema": {
            "$ref": "#/backend/entities/Appointment"
          },
          "description": "Stores appointment information for a specific user.  Uses path-based ownership to link appointments to users.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user (patient)."
            },
            {
              "name": "appointmentId",
              "description": "The unique identifier for the appointment."
            }
          ]
        }
      },
      {
        "path": "/articles/{articleId}",
        "definition": {
          "entityName": "Article",
          "schema": {
            "$ref": "#/backend/entities/Article"
          },
          "description": "Stores mental health articles accessible to all users.",
          "params": [
            {
              "name": "articleId",
              "description": "The unique identifier for the article."
            }
          ]
        }
      },
      {
        "path": "/communities/{communityId}",
        "definition": {
          "entityName": "Community",
          "schema": {
            "$ref": "#/backend/entities/Community"
          },
          "description": "Stores community forum information. Includes 'memberIds' for managing community membership.",
          "params": [
            {
              "name": "communityId",
              "description": "The unique identifier for the community."
            }
          ]
        }
      },
      {
        "path": "/google_oauth/{userId}",
        "definition": {
          "entityName": "GoogleOAuth",
          "schema": {
            "$ref": "#/backend/entities/GoogleOAuth"
          },
          "description": "Stores Google OAuth authentication data associated with a user. The userId references UserProfile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to UserProfile."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization independence is achieved through denormalization of authorization-related data. The structure employs structural segregation to maintain a homogeneous security posture within each collection. Access modeling follows consistent patterns for private and collaborative data, leveraging path-based ownership and membership maps.\n\nSpecifically, user profiles are stored under `/users/{userId}` using path-based ownership. Psychiatrist profiles are located in a subcollection `/users/{userId}/psychiatristProfile`. Appointments are also structured under the user path `/users/{userId}/appointments/{appointmentId}` to ensure that appointments are easily queryable by user. Articles are stored in a root-level collection `/articles` as they are globally accessible content. Communities are stored in a root-level collection `/communities/{communityId}`, with membership information managed through the `memberIds` field in the Community document. To enable 'Sign In with Google', a `/google_oauth/{userId}` collection is used, enabling easy lookup of google user details by `userId`.\n\nThis structure facilitates Authorization Independence by eliminating the need for `get()` calls in security rules. For example, access control for appointments can be directly determined by checking the `patientId` or `psychiatristId` against the `request.auth.uid` without needing to fetch the user's role or profile. QAPs are supported by segregating data with different access requirements into separate collections (e.g., public articles vs. private user profiles)."
  }
}